<!doctype html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <base href="/" />
    <title>Dashboard Analisi - Fondamenti di Automatica</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <%- include('partials/nav', { active: 'dashboard' }) %>
    <div class="bg-orbit"></div>
    <div class="bg-grid"></div>

    <div class="empty-state is-hidden" id="courseEmptyState">
      <div class="empty-state-content">
        <strong>Seleziona un corso per iniziare</strong>
        <a class="btn btn-primary" href="/home">
          <i class="fa-solid fa-graduation-cap"></i>
          Vai ai corsi
        </a>
      </div>
    </div>

    <main class="layout container-fluid admin-layout py-4" id="mainLayout">
      <div class="builder-topbar grading-topbar">
        <div class="builder-topbar-left">
          <button class="btn btn-outline-secondary" id="analysisTopbarSelectExam" type="button">
            <i class="fa-solid fa-list-check"></i>
            Seleziona traccia
          </button>
        </div>
        <div class="builder-topbar-right">
          <span class="toolbar-status" id="analysisTopbarStatus">Nessuna traccia</span>
        </div>
      </div>
      <div class="empty-state" id="analysisEmptyState">
        <div class="empty-state-content">
          <strong>Seleziona una traccia per iniziare</strong>
          <button class="btn btn-primary" type="button" id="analysisSelectExam">
            <i class="fa-solid fa-list-check"></i>
            Seleziona traccia
          </button>
        </div>
      </div>

      <section class="card shadow-sm mb-4 analysis-section is-hidden" id="analysisExamSection">
        <div class="card-header">
          <div class="card-header-row">
            <div>
              <h2 class="h5 mb-1">Seleziona traccia</h2>
              <p class="text-secondary mb-0">Analisi basata sulle sessioni di correzione salvate.</p>
            </div>
            <div class="header-actions">
              <span class="toolbar-status" id="analysisStatus">Nessuna traccia selezionata</span>
            </div>
          </div>
        </div>
      </section>

      <section class="card shadow-sm mb-4 analysis-section is-hidden" id="analysisSessionSection">
        <div class="card-header">
          <div class="card-header-row">
            <div>
              <h2 class="h5 mb-1">Sessione di correzione</h2>
              <p class="text-secondary mb-0">Seleziona la sessione su cui calcolare le metriche.</p>
            </div>
            <div class="header-actions">
              <label class="field">
                <span>Sessione</span>
                <select id="analysisSessionSelect" class="form-select"></select>
              </label>
            </div>
          </div>
        </div>
      </section>

      <section class="empty-state is-hidden" id="analysisSessionEmpty">
        <div class="empty-state-content">
          <strong>Sessione vuota</strong>
          <span class="text-secondary">Non ci sono studenti valutati in questa sessione.</span>
          <a class="btn btn-primary" href="/valutazione">
            <i class="fa-solid fa-pen-to-square"></i>
            Correggi l'esame
          </a>
        </div>
      </section>

      <section class="card shadow-sm mb-4 analysis-section is-hidden" id="analysisSummary">
        <div class="card-header">
          <h2 class="h5 mb-1">Sintesi</h2>
          <p class="text-secondary mb-0">Indicatori rapidi sull'andamento della sessione.</p>
        </div>
        <div class="analysis-kpis" id="analysisKpis"></div>
      </section>

      <section class="card shadow-sm mb-4 analysis-section is-hidden" id="analysisQuestionsSection">
        <div class="card-header">
          <h2 class="h5 mb-1">Domande</h2>
          <!-- <p class="text-secondary mb-0">Percentuale corrette e difficolta stimata.</p> -->
        </div>
        <div class="table-wrap">
          <table class="table table-sm align-middle analysis-table">
            <thead>
              <tr>
                <th>Es.</th>
                <th>Domanda</th>
                <th>Argomenti</th>
                <th>% corrette</th>
                <th>Esito</th>
              </tr>
            </thead>
            <tbody id="analysisQuestions"></tbody>
          </table>
        </div>
      </section>

      <section class="card shadow-sm analysis-section is-hidden" id="analysisTopicsSection">
        <div class="card-header">
          <h2 class="h5 mb-1">Argomenti</h2>
          <!-- <p class="text-secondary mb-0">Media corrette per argomento.</p> -->
        </div>
        <div class="table-wrap">
          <table class="table table-sm align-middle analysis-table">
            <thead>
              <tr>
                <th>Argomento</th>
                <th>% corrette</th>
                <th>Domande</th>
              </tr>
            </thead>
            <tbody id="analysisTopics"></tbody>
          </table>
        </div>
      </section>

      <section class="card shadow-sm analysis-section is-hidden" id="analysisCheatingSection">
        <div class="card-header">
          <div class="card-header-row">
            <div>
              <h2 class="h5 mb-1">Similarit√† risposte</h2>
              <p class="text-secondary mb-0">Coppie con S2 oltre la soglia statistica.</p>
            </div>
            <div class="header-actions">
              <span class="toolbar-status" id="analysisCheatingStatus">Nessun calcolo</span>
              <button class="btn btn-outline-primary btn-sm" type="button" id="analysisCheatingRun">
                <i class="fa-solid fa-magnifying-glass-chart"></i>
                Calcola
              </button>
            </div>
          </div>
        </div>
        <div class="table-wrap">
          <table class="table table-sm align-middle analysis-table">
            <thead>
              <tr>
                <th>Studente A</th>
                <th>Studente B</th>
                <th>S2</th>
                <th>Match errati</th>
                <th>Domande</th>
              </tr>
            </thead>
            <tbody id="analysisCheating"></tbody>
          </table>
        </div>
      </section>
    </main>

    <div class="modal-backdrop is-hidden" id="analysisExamBackdrop"></div>
    <div class="modal-panel is-hidden" id="analysisExamModal" role="dialog" aria-modal="true" aria-labelledby="analysisExamTitle">
      <div class="modal-header">
        <h3 class="h5 mb-0" id="analysisExamTitle">Seleziona traccia</h3>
        <button class="btn btn-outline-secondary btn-icon btn-sm" type="button" id="analysisExamClose" aria-label="Chiudi">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="template-status text-secondary" id="analysisStatus">Nessuna traccia selezionata</div>
        <div id="analysisExamList" class="exam-grid"></div>
      </div>
    </div>

    <div class="toast-notify" id="analysisToast" role="status" aria-live="polite"></div>

    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/latex.js/dist/latex.min.js"
    ></script>
    <script src="exam-cards.js"></script>
    <script src="dashboard.js"></script>
  </body>
</html>
